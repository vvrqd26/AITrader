# ä»·æ ¼é¢„è­¦ä¼˜åŒ–è¯´æ˜

## âœ… å·²å®Œæˆçš„æ”¹è¿›

### 1. **é˜²æ­¢é‡å¤è®¾ç½®**
```python
def create_alert(self, price, condition, ...):
    # æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒçš„é¢„è­¦
    for alert in self.alerts.values():
        if abs(alert.price - price) < 0.01 and alert.condition == condition:
            return alert.id  # è¿”å›å·²æœ‰IDï¼Œä¸åˆ›å»ºæ–°çš„
```

**æ•ˆæœ**:
- Agentå¤šæ¬¡è®¾ç½®ç›¸åŒé¢„è­¦ â†’ åªåˆ›å»ºä¸€æ¬¡
- é¿å…é‡å¤è§¦å‘

---

### 2. **System Prompt ç‹¬ç«‹æ–‡ä»¶**

**æ–°ä½ç½®**: `prompts/system_prompt.md`

**æ ¼å¼**: Markdownï¼Œæ˜“è¯»æ˜“ç¼–è¾‘

**åŠ è½½é€»è¾‘**:
```python
# ä¼˜å…ˆä»æ–‡ä»¶åŠ è½½
if exists('prompts/system_prompt.md'):
    return read_file()
else:
    return config.jsonä¸­çš„å†…å®¹  # é™çº§æ–¹æ¡ˆ
```

**å¥½å¤„**:
- âœ… Markdownæ ¼å¼ï¼Œå±‚æ¬¡æ¸…æ™°
- âœ… ç‹¬ç«‹æ–‡ä»¶ï¼Œæ˜“äºç¼–è¾‘
- âœ… æ”¯æŒæ³¨é‡Šå’Œæ’ç‰ˆ
- âœ… ç‰ˆæœ¬æ§åˆ¶å‹å¥½

**ç¼–è¾‘æ–¹æ³•**:
```bash
vim prompts/system_prompt.md
# æˆ–
code prompts/system_prompt.md
```

---

### 3. **é¢„è­¦çŠ¶æ€æŒä¹…åŒ–**

**ä¿å­˜å†…å®¹**:
```json
{
  "price_alerts": {
    "alerts": [
      {
        "id": "alert_abc123",
        "price": 2950.0,
        "condition": "above",
        "description": "çªç ´é˜»åŠ›ä½",
        "create_time": "2025-11-27T00:00:00",
        "triggered": false
      }
    ],
    "last_price": 2930.5
  }
}
```

**æ¢å¤é€»è¾‘**:
```python
# å¯åŠ¨æ—¶è‡ªåŠ¨æ¢å¤é¢„è­¦
alert_manager.from_dict(saved_state['price_alerts'], callback)
```

**æ•ˆæœ**:
- âœ… é‡å¯åé¢„è­¦ç»§ç»­æœ‰æ•ˆ
- âœ… ä¸ä¼šä¸¢å¤±æœªè§¦å‘çš„é¢„è­¦

---

### 4. **Webé¢æ¿æ˜¾ç¤ºé¢„è­¦**

**æ–°å¢åŒºåŸŸ**:
```
[Price Alertsé¢æ¿]
- alert_abc123 - ABOVE $2950.00
  çªç ´é˜»åŠ›ä½
  åˆ›å»ºæ—¶é—´: 2025-11-27 00:00:00
```

**å®æ—¶æ›´æ–°**:
- WebSocketæ¨é€
- æ˜¾ç¤ºé¢„è­¦IDã€ä»·æ ¼ã€æ¡ä»¶ã€æè¿°

---

### 5. **é¢„è­¦è§¦å‘æœºåˆ¶æ˜ç¡®**

**é‡è¦è¯´æ˜**:
```
é¢„è­¦æ˜¯ä¸€æ¬¡æ€§çš„ï¼
- è§¦å‘åç«‹å³åˆ é™¤
- ä¸ä¼šé‡å¤è§¦å‘
- Agentéœ€é‡æ–°è®¾ç½®
```

**æµç¨‹**:
```
è®¾ç½®é¢„è­¦: above 2950
  â†“
ä»·æ ¼2950.5 â†’ è§¦å‘
  â†“
å›è°ƒ: ç«‹å³æ‰§è¡ŒAIå†³ç­–
  â†“
åˆ é™¤é¢„è­¦ (è‡ªåŠ¨)
  â†“
å¦‚éœ€ç»§ç»­ç›‘æ§ â†’ Agenté‡æ–°è®¾ç½®
```

---

## ğŸ“Š é¢„è­¦ç”Ÿå‘½å‘¨æœŸ

```
åˆ›å»º
  â†“
ä¿å­˜åˆ°state.json
  â†“
å®æ—¶ç›‘æ§ä»·æ ¼
  â†“
è§¦å‘æ¡ä»¶æ»¡è¶³
  â†“
æ‰§è¡Œå›è°ƒ (è§¦å‘AIå†³ç­–)
  â†“
è‡ªåŠ¨åˆ é™¤
  â†“
ä»state.jsonç§»é™¤
```

---

## ğŸ¯ Promptæ›´æ–°

### æ–°å¢è¯´æ˜

åœ¨`prompts/system_prompt.md`ä¸­æ˜ç¡®:

```markdown
## ä»·æ ¼é¢„è­¦ä½¿ç”¨

### é‡è¦è¯´æ˜
- **é¢„è­¦æ˜¯ä¸€æ¬¡æ€§çš„**ï¼Œè§¦å‘åè‡ªåŠ¨åˆ é™¤
- **ä¸è¦é‡å¤è®¾ç½®ç›¸åŒçš„é¢„è­¦**ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å»é‡
- é¢„è­¦è§¦å‘åä¼šç«‹å³è°ƒç”¨ä½ é‡æ–°å†³ç­–ï¼Œæ— éœ€ç­‰å¾…ä¸‹ä¸ªå‘¨æœŸ
- å¦‚æœä½ è®¾ç½®äº†é¢„è­¦ï¼Œè¯´æ˜å½“å‰ä¸é€‚åˆç«‹å³äº¤æ˜“ï¼Œåº”è¯¥**è§‚æœ›ç­‰å¾…**

### é¢„è­¦ vs äº¤æ˜“è®¡åˆ’
- **ä»·æ ¼é¢„è­¦**ï¼šè§¦å‘åé‡æ–°è¯„ä¼°å¸‚åœºï¼Œå†å†³å®šæ˜¯å¦äº¤æ˜“
- **äº¤æ˜“è®¡åˆ’**ï¼šè§¦å‘åç«‹å³æŒ‰è®¡åˆ’å¼€ä»“
- å¦‚æœä½ å¯¹å…¥åœºç‚¹æœ‰ä¿¡å¿ƒï¼Œç”¨äº¤æ˜“è®¡åˆ’ï¼›å¦‚æœéœ€è¦åˆ°æ—¶å†åˆ¤æ–­ï¼Œç”¨ä»·æ ¼é¢„è­¦
```

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### é˜²é‡å¤æœºåˆ¶
```python
# ä»·æ ¼ç›¸å·®<0.01 ä¸” æ–¹å‘ç›¸åŒ â†’ è§†ä¸ºé‡å¤
if abs(alert.price - price) < 0.01 and alert.condition == condition:
    return existing_id
```

### æŒä¹…åŒ–åºåˆ—åŒ–
```python
# ä¿å­˜
alert_manager.to_dict() â†’ state.json

# æ¢å¤
alert_manager.from_dict(data, callback)
```

### Webé¢æ¿æ›´æ–°
```javascript
// æ¯æ¬¡å¾ªç¯æ›´æ–°
web_panel.update_price_alerts(alerts)

// WebSocketæ¨é€åˆ°å‰ç«¯
ws.send(state_data)
```

---

## ğŸ“‹ ä½¿ç”¨ç¤ºä¾‹

### Agentä½¿ç”¨
```
åˆ†æ: "ç­‰å¾…çªç ´2950å†åšå¤š"
æ“ä½œ: set_price_alert(price=2950, condition='above', 
                      description='çªç ´2950é˜»åŠ›')

ç»“æœ: 
- é¢„è­¦åˆ›å»º âœ…
- æ˜¾ç¤ºåœ¨é¢æ¿ âœ…
- ä¿å­˜åˆ°state.json âœ…
- ä»·æ ¼åˆ°2950.5 â†’ è§¦å‘ âœ…
- ç«‹å³é‡æ–°å†³ç­– âœ…
- é¢„è­¦è‡ªåŠ¨åˆ é™¤ âœ…
```

### é˜²é‡å¤
```
å‘¨æœŸ1: set_price_alert(2950, 'above') â†’ åˆ›å»º alert_001
å‘¨æœŸ2: set_price_alert(2950, 'above') â†’ è¿”å› alert_001 (ä¸é‡å¤åˆ›å»º)
å‘¨æœŸ3: set_price_alert(2950, 'above') â†’ è¿”å› alert_001

ç»“æœ: åªæœ‰ä¸€ä¸ªé¢„è­¦ï¼Œä¸ä¼šé‡å¤è§¦å‘
```

### æŒä¹…åŒ–
```
è®¾ç½®é¢„è­¦ â†’ ä¿å­˜åˆ°state.json
  â†“
åœæ­¢ç³»ç»Ÿ
  â†“
é‡å¯ç³»ç»Ÿ
  â†“
è‡ªåŠ¨æ¢å¤é¢„è­¦ âœ…
  â†“
ç»§ç»­ç›‘æ§
```

---

## ğŸ‰ æ€»ç»“

**4ä¸ªé—®é¢˜å…¨éƒ¨è§£å†³**:

1. âœ… **é‡å¤è®¾ç½®** - è‡ªåŠ¨å»é‡
2. âœ… **Promptå¯è¯»æ€§** - ç‹¬ç«‹Markdownæ–‡ä»¶
3. âœ… **é¢„è­¦æŒä¹…åŒ–** - ä¿å­˜åˆ°state.json
4. âœ… **é¢æ¿æ˜¾ç¤º** - æ–°å¢Price Alertsé¢æ¿

**è§¦å‘æœºåˆ¶**:
- é¢„è­¦æ˜¯**ä¸€æ¬¡æ€§çš„**
- è§¦å‘å**è‡ªåŠ¨åˆ é™¤**
- **ä¸ä¼šé‡å¤è§¦å‘**
- Agentéœ€è¦æ—¶**é‡æ–°è®¾ç½®**

ç°åœ¨ç³»ç»Ÿæ›´å®Œå–„äº†! ğŸš€
